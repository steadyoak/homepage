<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>Connecting...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cache-control" content="no-store">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">
</head>
<body>
  <div id="status">Connecting to service…</div>

  <script>
    const API = "https://cn-hk-bgp-4.ofalias.net:54048/addr";
    const TIMEOUT = 5000;

    async function main() {
      const ctrl = new AbortController();
      setTimeout(() => ctrl.abort(), TIMEOUT);

      try {
        const resp = await fetch(API, {
          cache: "no-store",
          signal: ctrl.signal
        });

        if (!resp.ok) {
          throw new Error("HTTP " + resp.status);
        }

        const data = await resp.json();
        if (!data.url) {
          throw new Error("Invalid response");
        }

        // 不保留中转页历史
        location.replace(data.url);

      } catch (e) {
        document.getElementById("status").textContent =
          "Failed to connect: " + e.message;
      }
    }

    main();
  </script>
</body>
</html>
